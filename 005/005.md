# WSL1 å‡çº§ WSL2 è®°å½•

- [WSL1 å‡çº§ WSL2 è®°å½•](#wsl1-å‡çº§-wsl2-è®°å½•)
  - [ä»€ä¹ˆæ˜¯ WSL](#ä»€ä¹ˆæ˜¯-wsl)
  - [WSL1 å’Œ WSL2 çš„åŒºåˆ«](#wsl1-å’Œ-wsl2-çš„åŒºåˆ«)
  - [å‡çº§æµç¨‹](#å‡çº§æµç¨‹)
    - [æ­¥éª¤1 - å¯ç”¨ç›¸å…³åŠŸèƒ½](#æ­¥éª¤1---å¯ç”¨ç›¸å…³åŠŸèƒ½)
    - [æ­¥éª¤2 - ä¸‹è½½ Linux å†…æ ¸æ›´æ–°åŒ…](#æ­¥éª¤2---ä¸‹è½½-linux-å†…æ ¸æ›´æ–°åŒ…)
    - [æ­¥éª¤3 - è®¾ç½®é»˜è®¤ç‰ˆæœ¬ä¸º WSL 2](#æ­¥éª¤3---è®¾ç½®é»˜è®¤ç‰ˆæœ¬ä¸º-wsl-2)
    - [æ­¥éª¤4 - è½¬æ¢ç°æœ‰çš„ WSL 1](#æ­¥éª¤4---è½¬æ¢ç°æœ‰çš„-wsl-1)
      - [æŸ¥çœ‹å·²ç»å®‰è£…çš„ Linux åˆ†å‘ç‰ˆ](#æŸ¥çœ‹å·²ç»å®‰è£…çš„-linux-åˆ†å‘ç‰ˆ)
      - [è½¬æ¢å¯¹åº”çš„åˆ†å‘ç‰ˆ](#è½¬æ¢å¯¹åº”çš„åˆ†å‘ç‰ˆ)
  - [å…¶ä»–æµç¨‹](#å…¶ä»–æµç¨‹)
    - [Ubuntu å‡çº§æµç¨‹](#ubuntu-å‡çº§æµç¨‹)
      - [ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œå‡çº§](#ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œå‡çº§)
      - [ä½¿ç”¨ GUI](#ä½¿ç”¨-gui)
        - [ç›¸å…³é—®é¢˜](#ç›¸å…³é—®é¢˜)
          - [ç•Œé¢é—ªçƒ](#ç•Œé¢é—ªçƒ)
          - [åº”ç”¨å´©æºƒ](#åº”ç”¨å´©æºƒ)
    - [ä½¿ç”¨å›¾å½¢åŠ é€Ÿ](#ä½¿ç”¨å›¾å½¢åŠ é€Ÿ)

> ä¸»è¦å‚è€ƒ [å¾®è½¯ WLS æ–‡æ¡£](https://docs.microsoft.com/zh-cn/windows/wsl/)

## ä»€ä¹ˆæ˜¯ WSL

WSL å…¨ç§° `Windows Subsystem for Linux` ï¼Œæ˜¯èƒ½å¤Ÿç›´æ¥è¿è¡Œåœ¨ windows 10 ç³»ç»Ÿä¸Šçš„ GNU/Linux ç¯å¢ƒï¼ŒWSL å’Œè™šæ‹Ÿæœºå’ŒåŒç³»ç»Ÿçš„åŒºåˆ«ï¼š

|  ç±»å‹  | ä¸ windows åŒæ—¶ä½¿ç”¨ |       å…±äº«æ–‡ä»¶        |  èµ„æºå ç”¨  |                     å®‰è£…éš¾åº¦                     | èƒ½å¦å¤‡ä»½ |
| :----: | :-----------------: | :-------------------: | :--------: | :----------------------------------------------: | :------: |
|  WSL   |          âœ…          | âœ…ï¼Œç›´æ¥ä¸ç³»ç»Ÿæ–‡ä»¶äº¤äº’ |     å°     |         å¾®è½¯æ–‡æ¡£ï¼Œå¾®è½¯å•†åº—ä¸‹è½½ï¼Œè‡ªåŠ¨å®‰è£…         |    ğŸˆš     |
| è™šæ‹Ÿæœº |          âœ…          |   âœ…ï¼Œä½¿ç”¨å…±äº«æ–‡ä»¶å¤¹   |    è¾ƒå¤š    | å¯¹åº”åˆ†å‘ç‰ˆæ–‡æ¡£ï¼Œé¢å¤–è™šæ‹Ÿæœºè½¯ä»¶ï¼Œå®Œæ•´ç³»ç»Ÿå®‰è£…æµç¨‹ | å¿«ç…§åŠŸèƒ½ |
| åŒç³»ç»Ÿ |          âŒ          |           âŒ           | *æ— æ³•æ¯”è¾ƒ* |  å¯¹åº”åˆ†å‘æœ¬æ–‡æ¡£ï¼Œé¢å¤–å¼•å¯¼ç¡¬ä»¶ï¼Œå®Œæ•´ç³»ç»Ÿå®‰è£…æµç¨‹  |    ğŸˆš     |

å¯¹äºæœ‰å¸¸é©» windows ï¼Œä½†åˆéœ€è¦ Linux ç¯å¢ƒçš„éœ€æ±‚ï¼ŒWSL å¯ä»¥è¯´æ˜¯ä¸€ä¸ªè¿‘ä¹å®Œç¾çš„é€‰æ‹©äº†ã€‚

## WSL1 å’Œ WSL2 çš„åŒºåˆ«

> å…·ä½“å®Œæ•´å†…å®¹è¯·æŸ¥é˜… [å¾®è½¯ WSL æ–‡æ¡£ï¼šæ¯”è¾ƒ WSL 1 å’Œ WSL 2](https://docs.microsoft.com/zh-cn/windows/wsl/compare-versions)

| åŠŸèƒ½                                           | WSL 1 | WSL 2 |
| :--------------------------------------------- | :---: | :---: |
| Windows å’Œ Linux ä¹‹é—´çš„é›†æˆ                    |   âœ…   |   âœ…   |
| å¯åŠ¨æ—¶é—´çŸ­                                     |   âœ…   |   âœ…   |
| ä¸ä¼ ç»Ÿè™šæ‹Ÿæœºç›¸æ¯”ï¼Œå ç”¨çš„èµ„æºé‡å°‘               |   âœ…   |   âœ…   |
| å¯ä»¥ä¸å½“å‰ç‰ˆæœ¬çš„ VMware å’Œ VirtualBox ä¸€èµ·è¿è¡Œ |   âœ…   |   âœ…   |
| æ‰˜ç®¡ VM                                        |   âŒ   |   âœ…   |
| å®Œæ•´çš„ Linux å†…æ ¸                              |   âŒ   |   âœ…   |
| å®Œå…¨çš„ç³»ç»Ÿè°ƒç”¨å…¼å®¹æ€§                           |   âŒ   |   âœ…   |
| è·¨ OS æ–‡ä»¶ç³»ç»Ÿçš„æ€§èƒ½                           |   âœ…   |   âŒ   |

> ä¸ºä»€ä¹ˆæ˜¯ WSL 1 å‡çº§åˆ° WSL 2

ç¬”è€…åœ¨ä¹‹å‰å·²ç»ç”¨äº†å¾ˆä¹…çš„ WSL 1 äº†ï¼Œå› ä¸ºæœ‰é•¿æ—¶é—´ä½¿ç”¨ windows çš„éœ€æ±‚ ï¼Œè¿˜èƒ½å¤Ÿå¤Ÿäº«å— Linux çš„ç¯å¢ƒï¼Œä½†é‚£æ—¶å€™ç”±äº Hyper-V ï¼ˆWSL 2 çš„ç¡¬æ€§è¦æ±‚ï¼‰ä¸èƒ½å¤Ÿå’Œ vbox å…¼å®¹ï¼Œéƒ¨åˆ†æƒ…å†µä¸‹å¯¹è™šæ‹Ÿæœºæœ‰ç•Œé¢éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œåªèƒ½æš‚æ—¶ç»§ç»­ä½¿ç”¨ WSL 1 äº†ã€‚

WSL 2 åœ¨æœ€è¿‘çš„ windows insider ç‰ˆæœ¬ä¸­åŠ å…¥äº†å¯¹ GUI çš„æ”¯æŒï¼Œèƒ½å¤Ÿåœ¨ windows ç¯å¢ƒä¸‹ä½¿ç”¨åˆ°ç±»åŸç”Ÿçš„ Linux å¸¦UI åº”ç”¨ï¼Œå¹¶ä¸”æ˜¾å¡å‚å•†ä¹Ÿæ·»åŠ äº†å¯¹ WSL 2 çš„ç¡¬ä»¶åŠ é€Ÿï¼Œèƒ½å¤Ÿæ›´åŠ æ–¹ä¾¿åœ°ä½¿ç”¨ä½¿ç”¨ WSL 2 æ¥è¿›è¡Œæœºå™¨å­¦ä¹ ã€‚

## å‡çº§æµç¨‹

> è¯¦æƒ…è¯·æŸ¥é˜…ï¼š[å¾®è½¯ WSL æ–‡æ¡£ï¼šé€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿå®‰è£…æŒ‡å— (Windows 10)](https://docs.microsoft.com/zh-cn/windows/wsl/install-win10)

ä¸ªäººç¯å¢ƒï¼š

- windows 10 ç³»ç»Ÿï¼Œinsider ç‰ˆæœ¬ dev é€šé“
- WSL 1 çš„ `Ubuntu 18.04`
- ç‹¬æ˜¾ GTX 1060
- **é›†æ˜¾è¢«ç‰©ç†å±è”½**

### æ­¥éª¤1 - å¯ç”¨ç›¸å…³åŠŸèƒ½

**å¯ç”¨é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ**ï¼šåœ¨ powershell ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤

```powershell
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
```

**å¯ç”¨è™šæ‹ŸæœºåŠŸèƒ½**ï¼šåœ¨ powershell ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤

```powershell
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

### æ­¥éª¤2 - ä¸‹è½½ Linux å†…æ ¸æ›´æ–°åŒ…

ä¸‹è½½é“¾æ¥ï¼š[é€‚ç”¨äº x64 è®¡ç®—æœºçš„ WSL2 Linux å†…æ ¸æ›´æ–°åŒ…](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)ï¼Œä¸‹è½½å®Œæˆåç›´æ¥åŒå‡»è¿è¡Œ `.msi` æ–‡ä»¶å³å¯

### æ­¥éª¤3 - è®¾ç½®é»˜è®¤ç‰ˆæœ¬ä¸º WSL 2

åœ¨ powershell æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š

```powershell
wsl --set-default-version 2
```

> ä¸ºä»€ä¹ˆç”¨è¿™æ¡å‘½ä»¤ï¼Ÿï¼ˆè¸©è¿‡çš„å‘ï¼‰

å¦‚æœæ²¡æœ‰å°†é»˜è®¤ç‰ˆæœ¬è®¾ç½®ä¸º WSL 2 çš„è¯ï¼Œä»å¾®è½¯å•†åº—å®‰è£…çš„ WSL å°†ä¼šé»˜è®¤ä¸º1ï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œç‰ˆæœ¬è½¬æ¢ï¼ˆè¸©è¿‡çš„å‘ï¼šå¼€å¼€å¿ƒå¿ƒç”¨äº†ä¸€ä¼šå„¿ 20.04ï¼Œæƒ³è¯•è¯• GUI çš„æ—¶å€™ï¼Œå‘ç°è‡ªå·±æ˜¯ WSL 1 ï¼Œè¿˜å¾—æ‰‹åŠ¨è½¬æ¢åˆ° WSL 2 ğŸ˜‚ï¼‰

### æ­¥éª¤4 - è½¬æ¢ç°æœ‰çš„ WSL 1

#### æŸ¥çœ‹å·²ç»å®‰è£…çš„ Linux åˆ†å‘ç‰ˆ

åœ¨ powershell æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š

```powershell
wsl --list --verbose
# ç­‰ä»·äº
# wsl -l -v
```

æ‰¾åˆ°è‡ªå·±æƒ³è½¬åŒ–çš„ WSL 1 çš„åå­—ï¼Œä¾‹å¦‚æˆ‘è¿™è¾¹å°±æ˜¯ `Ubuntu` ï¼Œå¦‚ä¸‹å›¾ï¼š

![wsl -l -v](./img/wsl-l-v.png)

> å›¾ä¸­æˆ‘çš„ `Ubuntu` å·²ç»æ˜¯ WSL 2 äº†ï¼Œå¦‚æœæ˜¯ WSL 1 çš„è¯ï¼Œé‚£ä¹ˆ `VERSION` åˆ—é‚£é‡Œåº”è¯¥æ˜¯**1**

#### è½¬æ¢å¯¹åº”çš„åˆ†å‘ç‰ˆ

åœ¨ powershell æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š

```powershell
wsl --set-version <distribution name> <versionNumber>
# å¯¹æˆ‘æ¥è¯´å°±æ˜¯
# wsl --set-version Ubuntu 2
```

WSL 1 åˆ° WSL 2 çš„è½¬æ¢éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œè€å¿ƒç­‰å¾…å³å¯ï¼Œæ‰§è¡Œè¿‡ç¨‹å¦‚å›¾ï¼š

![è½¬æ¢](./img/WSL1_to_WSL2.png)

## å…¶ä»–æµç¨‹

### Ubuntu å‡çº§æµç¨‹

ç”±äº Ubuntu çš„ LTS å·²ç»æ˜¯20.04ï¼Œæ–°å¢äº†è®¸å¤šç‰¹æ€§ï¼Œè€Œæˆ‘çš„ WSL ä»ç„¶æ˜¯18.04ï¼Œå› æ­¤éœ€è¦è¿›è¡Œå‡çº§

#### ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œå‡çº§

> ä¸ºä»€ä¹ˆä¸ç”¨ç›´æ¥**å›¾å½¢æ›´æ–°ç®¡ç†å™¨**ï¼Ÿ

è¿™ä¸åºŸè¯ä¹ˆï¼ŒWSL å“ªæ¥å›¾å½¢æ¡Œé¢ï¼Œæˆ‘å‡çº§ WSL å°±æ˜¯ä¸ºäº†å°é²œä½¿ç”¨ Linux ä¸‹å¸¦å›¾å½¢ç•Œé¢çš„åº”ç”¨

åœ¨ ubuntu ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå¼ºåˆ¶å‡çº§ï¼š

```bash
sudo apt update && sudo apt upgrade -y # å…ˆè¿›è¡Œå½“å‰ç³»ç»Ÿçš„æ›´æ–°
sudo do-release-upgrade -d # æ›´æ–°ç‰ˆæœ¬
```

ç­‰å¾…æ‰§è¡Œå®Œæˆåé‡å¯ WSL å³å¯ï¼Œé‡å¯å¯åœ¨ powershell ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š

```powershell
wsl --shutdown && wsl # å…ˆå…³é—­å†æ‰“å¼€
```

> ç„¶è€Œä½¿ç”¨æˆ‘ä½¿ç”¨å‘½ä»¤å‡çº§å¤±è´¥äº†ï¼Œåœ¨å‡çº§çš„æ—¶å€™ä¼šè‡ªåŠ¨æ¨å‡ºï¼Œå…·ä½“åŸå› ä¸æ¸…æ¥šï¼Œå’Œæœ‹å‹æ¨è®ºçŒœæµ‹æ˜¯å­˜åœ¨æŸäº›ä¸å…¼å®¹çš„ä¸œè¥¿ï¼›å‡çº§å¤±è´¥çš„å›¾ç‰‡å¦‚ä¸‹ï¼š
> 
> ![18.04 upgrade to 20.04 fail](./img/upgrade_fail.png)
> 
> æœ€åé€‰æ‹©æ˜¯å¸è½½ç°æœ‰ Ubuntu ç„¶åå»å¾®è½¯å•†åº—é‡æ–°ä¸‹äº†ä¸€ä¸ªï¼ˆç°åœ¨å¾®è½¯å•†åº—çš„ Ubuntu å·²ç»é»˜è®¤æ˜¯20.04äº†ï¼‰

#### ä½¿ç”¨ GUI

WSL ä½¿ç”¨ GUI çš„ç‰¹æ€§å…·ä½“å‚è€ƒï¼š[WSLg](https://github.com/microsoft/wslg)

å®‰è£…å¯¹åº”çš„æ˜¾å¡é©±åŠ¨å¹¶é‡å¯ WSL å³å¯ï¼š

- [AMD GPU driver for WSL](https://community.amd.com/community/radeon-pro-graphics/blog/2020/06/17/announcing-amd-support-for-gpu-accelerated-machine-learning-training-on-windows-10)
- [Intel GPU driver for WSL](https://downloadcenter.intel.com/download/29526)
- [NVIDIA GPU driver for WSL](https://developer.nvidia.com/cuda/wsl)

æˆ‘é€‰æ‹©å®‰è£…çš„æ˜¯ NVIDIA çš„ GeForce ç‰ˆæœ¬é©±åŠ¨

##### ç›¸å…³é—®é¢˜

æš—å½±ç²¾çµ4 8300H 1060 6G çš„é›†æ˜¾è¢«ç‰©ç†å±è”½ï¼Œæ— æ³•å®‰è£… Intel çš„é›†æ˜¾é©±åŠ¨ï¼Œåœ¨ä½¿ç”¨å¸¦ç•Œé¢çš„åº”ç”¨æ—¶ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼š

###### ç•Œé¢é—ªçƒ

åœ¨å¯åŠ¨ WSL åï¼Œå¤§æ¦‚ç‡å¯¼è‡´ä»»åŠ¡ç®¡ç†å™¨ï¼ˆå…¶ä»–çª—å£æœªæµ‹è¯•ï¼‰é«˜é¢‘ç‡é—ªåŠ¨ï¼Œå®ä¾‹å¦‚ä¸‹å›¾ï¼š

![é—ªçƒ](./img/é—ªçƒ.gif)

> çŒœæµ‹æ˜¯ WSL å¯¹åº”çš„æ˜¾å¡é©±åŠ¨å¯¼è‡´çš„é—®é¢˜ï¼Œåªèƒ½ç­‰å¾…è€é»„å‡ºæ–°çš„æ˜¾å¡é©±åŠ¨äº†

å¯ä»¥é€šè¿‡æš‚æ—¶ç¦ç”¨ WSL 2 çš„ GUI æ”¯æŒï¼Œç›´æ¥ç¦æ­¢ Wayland Server çš„å¯åŠ¨ï¼Œä»è€Œé¿å… GPU çš„è™šæ‹ŸåŒ–ã€‚å…·ä½“æ“ä½œä¸ºï¼š

1. åœ¨ `%userprofile%` ä¸‹é¢åˆ›å»ºä¸€ä¸ª `.wslconfig` çš„æ–‡ä»¶
2. åœ¨å…¶ä¸­è¾“å…¥å¦‚ä¸‹æ–‡æœ¬ï¼š

```text
[wsl2]
guiapplications=false
```

3. ä¿å­˜å¹¶é‡å¯ WSL

ä¸Šè¿°æ“ä½œå®Œæˆåï¼Œå°è¯•ä½¿ç”¨å¸¦ GUI çš„åº”ç”¨ä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼Œè¯´æ˜å…³é—­æˆåŠŸï¼š

![å…³é—­åè¿è¡Œå¸¦ç•Œé¢çš„åº”ç”¨æŠ¥é”™](./img/closeGUI.png)

###### åº”ç”¨å´©æºƒ

åœ¨é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨ microsoft-edge å¹¶ä¸”æ—¶å€™æ—¶ï¼Œä¼šåœ¨å‘½ä»¤è¡Œå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼š

![edge boom 1](./img/edge_boom_1.png)

ä½¿ç”¨ edge æ—¶æœ‰æ¦‚ç‡å¯¼è‡´ `Wayland Server` å´©æºƒï¼Œå¹¶ä¸”å¯¼è‡´æ‰€æœ‰å¸¦ç•Œé¢åº”ç”¨æ— æ³•å†æ¬¡å¯åŠ¨ï¼Œå†æ¬¡å°è¯•å¯åŠ¨ edge ä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š

![edge boom 2](./img/edge_boom_2.png)

`wayland` å´©æºƒåå°è¯•å¯åŠ¨ gedit ä¼šæœ‰å¦‚ä¸‹æŠ¥é”™ï¼š

![gedit](./img/gedit_boom.png)

> Wayland Server æ˜¯ WSL å®ç° GUI æ˜¾ç¤ºçš„é€”å¾„ï¼Œåªèƒ½ç­‰åç»­æ›´æ–°æé«˜ç¨³å®šæ€§

### ä½¿ç”¨å›¾å½¢åŠ é€Ÿ

> å¦‚æœéœ€è¦ä½¿ç”¨ Linux ä¸‹çš„å›¾å½¢åŠ é€Ÿï¼Œåˆ™éœ€è¦åœ¨ WSL ä¸­å®‰è£…å¯¹åº”çš„ cuda ï¼Œè¯¦æƒ…æŸ¥é˜…ï¼š[CUDA on WSL User Guide](https://docs.nvidia.com/cuda/wsl-user-guide/index.html)

åœ¨ Ubuntu ä¸­åˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç”¨äºå®‰è£… cuda ï¼š

```bash
apt-key adv --fetch-keys http://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/7fa2af80.pub # è·å–å¯¹åº”çš„ key ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘æ˜¯ç”¨çš„20.04ç‰ˆæœ¬çš„

sh -c 'echo "deb http://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64 /" > /etc/apt/sources.list.d/cuda.list' # æ·»åŠ ä»“åº“ä¸‹è½½é“¾æ¥

apt-get update # æ›´æ–°
```

ä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š

![cannot install in cuda in ubuntu](./img/cannot_install_cuda_in_ubuntu.png)

å‘ç°æ˜¯å› ä¸º http://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/ ä¼šæ— å¿è·³è½¬åˆ° http://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2004/x86_64/ ï¼Œå³ä½¿æ˜¯æŒ‚äº†æ¢¯å­ï¼Œä¹Ÿä¼šè·³è½¬åˆ° `.cn` åŸŸåï¼Œæœ€ç»ˆå¯¼è‡´è·å–åˆ°çš„ä¸¤ä¸ªç­¾åä¸ä¸€è‡´ï¼Œä»è€Œæ— æ³•å®Œæˆæ›´æ–°