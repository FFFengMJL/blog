# ä¿¡æ¯å®‰å…¨ç¬¬ä¸ƒæ¬¡ä½œä¸šç›¸å…³æ‘¸ç´¢

- [ä¿¡æ¯å®‰å…¨ç¬¬ä¸ƒæ¬¡ä½œä¸šç›¸å…³æ‘¸ç´¢](#ä¿¡æ¯å®‰å…¨ç¬¬ä¸ƒæ¬¡ä½œä¸šç›¸å…³æ‘¸ç´¢)
  - [è¯´æ˜](#è¯´æ˜)
  - [é…ç½® gns3](#é…ç½®-gns3)
  - [é…ç½®ç›¸å…³è½¯ä»¶](#é…ç½®ç›¸å…³è½¯ä»¶)
    - [1. ç«¯å£æ˜ å°„](#1-ç«¯å£æ˜ å°„)
      - [2. æ„å»º docker](#2-æ„å»º-docker)
        - [1. ä¿®æ”¹ dockerhub æº](#1-ä¿®æ”¹-dockerhub-æº)
        - [2. åˆ›å»º Dockerfile æ–‡ä»¶](#2-åˆ›å»º-dockerfile-æ–‡ä»¶)
        - [3. æ„å»ºå®¹å™¨](#3-æ„å»ºå®¹å™¨)
        - [4. å¯¼å…¥åˆ° gns3 ä¸­](#4-å¯¼å…¥åˆ°-gns3-ä¸­)
    - [å…¶ä»–](#å…¶ä»–)
      - [1. ubuntu docker çš„ç›¸å…³é…ç½®æ–‡ä»¶](#1-ubuntu-docker-çš„ç›¸å…³é…ç½®æ–‡ä»¶)
      - [2. ä¸¤ä¸ªè·¯ç”±å™¨é…ç½®](#2-ä¸¤ä¸ªè·¯ç”±å™¨é…ç½®)
      - [3. arpspoof çš„ä½¿ç”¨](#3-arpspoof-çš„ä½¿ç”¨)
      - [4. tmux çš„ä½¿ç”¨](#4-tmux-çš„ä½¿ç”¨)

## è¯´æ˜

> å°è¯•ä½¿ç”¨ gns3 ä½œä¸ºæ¨¡æ‹Ÿè½¯ä»¶æ¥å°è¯•å®Œæˆç¬¬ä¸ƒæ¬¡ä¿¡æ¯å®‰å…¨ä½œä¸š

ç›¸å…³è½¯ä»¶ä¸‹è½½å¯ä»¥åœ¨æ ¡å›­ç½‘ä¸‹è®¿é—® [GNS3ç›¸å…³](http://172.18.40.111:51314/GNS3%e7%9b%b8%e5%85%b3/) ä¸‹è½½å¿…è¦çš„è½¯ä»¶ï¼š
- gns3 æœ¬ä½“
- gns3 è™šæ‹Ÿæœºï¼ˆæˆ‘åªä¸‹è½½äº† vbox çš„ï¼‰ï¼Œå¦‚æœç”¨ vmware æˆ–è€… hyper-v çš„è¯·å» [å®˜æ–¹ä¸‹è½½åœ°å€](https://www.gns3.com/software/download-vm)ä¸‹è½½å¯¹åº”çš„è™šæ‹Ÿæœºï¼Œå¹¶ä¸”æˆ‘ä¸ä¼šå¯¹åº”çš„ç«¯å£æ˜ å°„æ“ä½œï¼Œæ‰€ä»¥éœ€è¦ä½ ä»¬è‡ªå·±å»å¼„
- cisco 3640 è·¯ç”±å™¨é•œåƒæ–‡ä»¶
- cisco 7200 è·¯ç”±å™¨é•œåƒæ–‡ä»¶

## é…ç½® gns3

1. å®‰è£… gns3 ï¼ˆå®‰è£…è¿‡ç¨‹ä¸­ wireshark å’Œå¯¹åº”çš„è™šæ‹Ÿæœºå¯ä»¥çœ‹è‡ªå·±éœ€è¦æ˜¯å¦ä¸‹è½½ï¼Œæˆ‘è¿™é‡Œæ˜¯å®‰è£…è¿‡äº†æœ‰ç°æˆçš„æ‰€ä»¥ä¸ç”¨ï¼Œå‰©ä½™çš„ä¸œè¥¿éƒ½æ˜¯ä¹‹å‰å®‰è£…è¿‡çš„ gns3 å‰©ä¸‹çš„ï¼Œæ‰€ä»¥ä¸å®‰è£…ï¼Œä½ ä»¬è‡ªå·±å–èˆï¼‰ã€‚
2. è§£å‹è™šæ‹Ÿæœºå‹ç¼©æ–‡ä»¶ï¼Œå¯¼å…¥åˆ° vbox ä¸­ã€‚
3. åœ¨ gns3 ä¸­å¯¼å…¥ cisco çš„ä¸¤ä¸ªè·¯ç”±å™¨é•œåƒï¼Œå…·ä½“æ“ä½œè‡ªå·±è°·æ­Œä¸€ä¸‹ï¼Œå¾ˆç®€å•çš„ã€‚

æ‰“å¼€ gns3 çœ‹çœ‹èƒ½ä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œä¸ä¼š boom å°±å¥½ã€‚

> å¯¼å…¥è™šæ‹Ÿæœºçš„æ—¶å€™ä¼šè®©ä½ é€‰æ‹©ç”¨å¤šå°‘ä¸ª cpu å’Œå†…å­˜ï¼Œ**çœ‹ä½ å–œæ¬¢**ã€‚

## é…ç½®ç›¸å…³è½¯ä»¶

### 1. ç«¯å£æ˜ å°„

åœ¨ vbox å¤„è¿›è¡Œç«¯å£æ˜ å°„ã€‚è¿™ä¸€æ­¥æ˜¯ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ ssh è¿æ¥ä¸Šè™šæ‹Ÿæœºï¼Œä¸ç„¶åœ¨é‚£ä¸ªéå¸¸åŸå§‹çš„ç•Œé¢æ“ä½œéå¸¸è€ƒéªŒäººçš„è€å¿ƒï¼ˆå¦‚æœä½ è¦æ„¿æ„ï¼Œé‚£æˆ‘æ²¡è¯è¯´ï¼‰ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹å›¾ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªä¸»æœºåˆ°å­ç³»ç»Ÿ **22 ç«¯å£**çš„æ˜ å°„ï¼Œæˆ‘è¿™è¾¹é€‰æ‹©çš„æ˜¯ `ä¸»æœº 55022 -> å­ç³»ç»Ÿ 22`ï¼š

![ç«¯å£æ˜ å°„](./img/portMapping.png)

ä½¿ç”¨ ssh è¿æ¥ä¸Šè™šæ‹Ÿæœºï¼Œé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ `gns3`ï¼š

```bash
ssh gns3@127.0.0.1 -p 55022
```

è¿›å…¥ä¹‹åä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼š

![ç¬¬ä¸€æ¬¡è¿›å…¥ä¹‹å](./img/firstLogin.png)

ç›´æ¥å›è½¦ï¼ˆ**ä¸æ”¯æŒé¼ æ ‡çš„**ï¼‰ï¼Œè¿›å…¥ç¬¬äºŒä¸ª UI ç•Œé¢ï¼Œå¦‚å›¾ï¼š

![GUI](img/gns3VMGUI.png)

é€‰æ‹©æ©™è‰²æ¡†æ¡†çš„æŒ‰ä¸ª `Shell` ï¼Œä»è€Œè½¬åˆ°ä¸€ä¸ª shell ï¼Œä¹‹åçš„æ“ä½œå°±å’Œ ubuntu 18.04 çš„ç»ˆç«¯æ“ä½œä¸€æ ·äº†ï¼Œå¦‚ä¸‹å›¾ï¼š

![open a shell](./img/openShell.png)

> åœ¨è¿›å…¥ shell æ¨¡å¼åï¼Œé¡µé¢æ²¡æœ‰åˆ·æ–°ï¼Œæ‰€ä»¥çœ‹ç€å¾ˆéš¾å—ï¼Œå¯ä»¥ä½¿ç”¨ `clear` æˆ–è€… `reset` å‘½ä»¤åˆ·æ–°ä¸€ä¸‹ã€‚  
> æˆ‘è¿™è¾¹æ˜¯è‡ªå·±é…äº†ä¸ª zsh ï¼Œæ‰€ä»¥ä¹‹åå°±ä¼šä½¿ç”¨ zsh æ¥æ›¿ä»£åŸæœ‰çš„ bash ï¼Œä½†æ˜¯æ“ä½œéƒ½ä¸€æ ·ï¼Œæ‰€ä»¥æ²¡å•¥é—®é¢˜ã€‚  
> ![zsh](./img/zsh.png)

#### 2. æ„å»º docker

> ä¸ºä»€ä¹ˆéœ€è¦æ„å»º docker ï¼Ÿ
> 1. docker æ˜¯ä»€ä¹ˆï¼Œè‡ªå·±æŸ¥ã€‚æˆ‘ä¹Ÿæ²¡å¼„æ‡‚ï¼Œä½†æ˜¯èƒ½ç”¨å°±è¡Œã€‚
> 2. gns3 æ”¯æŒä½¿ç”¨è™šæ‹Ÿæœºæ¥æ¨¡æ‹Ÿå¯¹åº”çš„ç¡¬ä»¶ï¼Œæ¯”å¦‚è¯´ cisco 3640 å’Œ 7200 éƒ½æ˜¯è·¯ç”±å™¨çš„äºŒè¿›åˆ¶å›ºä»¶ã€‚
> 3. å¦‚æœä½¿ç”¨å®Œæ•´çš„è™šæ‹Ÿæœºçš„è¯ï¼Œå…ˆä¸è¯´ .iso æ–‡ä»¶éƒ½è¦2Gå¤šï¼Œå®‰è£…è¿‡ç¨‹ä¸å¾—éº»çƒ¦æ­»ï¼ˆè™½ç„¶ä½†æ˜¯ï¼Œæˆ‘æ²¡è¯•è¿‡ï¼Œæˆ‘äº‘çš„ï¼Œæˆ‘ççŒœçš„ï¼‰ï¼Œå¤ªæµªè´¹æ—¶é—´äº†ã€‚è€Œ docker å®¹å™¨åˆ™æ˜¯å·²ç»é…ç½®å¥½å¯¹åº”çš„ç¯å¢ƒäº†ï¼Œå¯ä»¥ç›´æ¥ç”¨ã€‚
> 4. gns3 è™šæ‹Ÿæœºä¸­å·²ç»é…ç½®å¥½äº† docker ç›¸å…³è½¯ä»¶äº†ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ”¹ä¸€ä¸‹ dockerHub æºå’Œå†™ä¸€ä¸‹ `Dockerfile` å°±å¯ä»¥æ„å»ºäº†ã€‚

##### 1. ä¿®æ”¹ dockerhub æº

> å‚è€ƒ[docker è®¾ç½®å›½å†…é•œåƒæº](https://blog.csdn.net/whatday/article/details/86770609)

ä¿®æ”¹ `/etc/docker/daemon.json` æ–‡ä»¶ä¸ºå¦‚ä¸‹ï¼š
```json
{
    "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn"]
}
```

> å†·çŸ¥è¯†ï¼š
> 1. è¿™ä¸ªè™šæ‹Ÿæœºåº”è¯¥æ˜¯å¸¦æœ‰ nano æˆ–è€… vi çš„ï¼Œé€‚åº”ä¸€ä¸‹è¿™ç§ç¼–è¾‘å™¨å§ã€‚
> 2. ä½¿ç”¨å…¶ä»–å®¢æˆ·ç«¯é€šè¿‡ ssh è¿æ¥è™šæ‹Ÿæœºçš„å¥½å¤„ä¹‹ä¸€ï¼šèƒ½å¤Ÿåœ¨ä¸»æœºå¤åˆ¶é»è´´åˆ°å¯¹åº”çš„ç»ˆç«¯ã€‚
> 3. ä¸Šé¢ä¿®æ”¹åçš„é•œåƒæºæ˜¯ä¸­ç§‘å¤§çš„ã€‚ï¼ˆæ¯” matrix çš„å¥½ï¼Œåº”è¯¥ï¼Ÿï¼‰

##### 2. åˆ›å»º Dockerfile æ–‡ä»¶

åœ¨ç”¨æˆ·æ ¹ç›®å½•ä¸‹åˆ›å»º `Dockerfile` ï¼š
```bash
cd ~/ && touch Dockerfile
```

åœ¨ Dockerfile ä¸­å†™å…¥å¦‚ä¸‹ï¼š
```Dockerfile
FROM ubuntu:20.04
RUN echo 'start to build\n' \
# è®¾ç½®é•œåƒæºä¸ºæ¸…åæº
&& sed -i 's/archive.ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list \
# æ³¨é‡Šæ‰æŸäº›ä¸œè¥¿
&& sed -i 's/deb http:\/\/security/#/g' /etc/apt/sources.list \
# è®¾ç½®è‡ªåŠ¨æ›´æ–°
&& apt update \
# å®‰è£… tcpdump ï¼Œç”¨äºä»£æ›¿ wireshark
&& apt-get install -y tcpdump \
# å®‰è£… net-tools ï¼Œç”¨äºä½¿ç”¨ ifconfig å‘½ä»¤
&& apt-get install -y net-tools \
# å®‰è£… iproute2 ï¼Œç”¨äºä½¿ç”¨ ip å‘½ä»¤ï¼ˆè™½ç„¶å¥½åƒç¡®å®æ²¡ç”¨åˆ°ï¼‰
&& apt-get install -y iproute2 \
# å®‰è£… iputils-ping ï¼Œç”¨äºä½¿ç”¨ ping å‘½ä»¤
&& apt-get install -y iputils-ping \
# å®‰è£… nmap å·¥å…·ï¼Œè™½ç„¶å®é™…ä¸Šå¯æœ‰å¯æ— 
&& apt-get install -y nmap \
# å®‰è£… dsniff å·¥å…·ï¼Œç”¨äºä½¿ç”¨ arpspoof å·¥å…·è¿›è¡Œ arp æ¬ºéª—
&& apt-get install -y dsniff \
# å®‰è£… driftnet å·¥å…·ï¼Œå¯ç”¨äºæ‹¦æˆªå¹¶è·å–ç›®æ ‡çš„æ¶ˆæ¯ï¼Œè™½ç„¶å®é™…ä¸Šæ²¡ç”¨åˆ°
&& apt-get install -y driftnet \
# å®‰è£… ssh nano å’Œ tmux
# å…¶ä¸­ tmux æ˜¯å¿…é¡»çš„ï¼
# å› ä¸ºæ”»å‡»æœºéœ€è¦ä½¿ç”¨ä¸¤ä¸ªç»ˆç«¯ï¼Œ
# ä½†æ˜¯ä½¿ç”¨ä¸¤ä¸ª console è¿æ¥åˆ°æ”»å‡»æœºï¼Œåªä¼šå‡ºç°ä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·çš„ç»ˆç«¯
# å› æ­¤éœ€è¦ä½¿ç”¨ tmux æ¥è¿›è¡Œåˆ†å±æ“ä½œ
&& apt-get install -y ssh nano tmux
```

##### 3. æ„å»ºå®¹å™¨

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ„å»ºå®¹å™¨ï¼š
```bash
# t/ubuntu æ˜¯å®¹å™¨åå­—ï¼Œä½ å¯ä»¥è‡ªå·±å–ä¸€ä¸ª
# . æˆ‘ä¸çŸ¥é“æ˜¯å•¥æ„æ€
docker build -t t/ubuntu .
```

æ„å»ºï¼Œç„¶åå¼€å§‹ç­‰è·‘å®Œï¼Œä½ å¯ä»¥è¶è¿™ä¸ªæ—¶å€™æ‘¸ä¸€ä¼šå„¿ğŸ ï¼š

![æ„å»ºå®¹å™¨](./img/dockerBuild.png)

å¦‚æœé‡åˆ°äº†ç±»ä¼¼å¦‚ä¸‹çš„é”™è¯¯çš„è¯ï¼Œå°è¯• build å‡ æ¬¡å°±å¥½ï¼Œå…·ä½“åŸå› æˆ‘ä¹Ÿä¸æ¸…æ¥šï¼š

![é‡åˆ°é”™è¯¯](./img/dockerBuildError.png)

> æˆ‘è¿™è¾¹æ˜¯é‡åˆ°äº†4æ¬¡ä¸Šé¢çš„é”™è¯¯æ‰æ„å»ºå¥½äº†çš„ã€‚

æ„å»ºæˆåŠŸï¼š

![åˆ›å»ºæˆåŠŸ](./img/buildSuccess.png)

##### 4. å¯¼å…¥åˆ° gns3 ä¸­

> è‡ªå·±æœä¸€ä¸‹ gns3 å¯¼å…¥åˆ›å»ºå¥½çš„ docker ï¼Œå¾ˆç®€å•çš„ã€‚

å‚è€ƒå¦‚ä¸‹å›¾ï¼š

![åˆ›å»ºæ–°çš„æ¨¡æ¿](./img/newDockerTemplate.png)

> é™¤äº†å›¾ä¸­è¿™ä¸ªåœ°æ–¹éœ€è¦é€‰æ‹©ä¹‹å¤–ï¼Œå…¶ä»–åœ°æ–¹åŸºæœ¬å¯ä»¥æ— è„‘ `Next`ã€‚

### å…¶ä»–

> ä¸Šé¢çš„ä¸œè¥¿é…ç½®å®Œä¹‹åï¼Œå°±æ˜¯æ‹–ä¸œè¥¿ï¼Œé…ç½®ä¸œè¥¿

è¿™é‡Œå¯èƒ½æœ‰ä½ éœ€è¦äº†è§£çš„ä¸€ä¸‹ä¸œè¥¿ï¼š

#### 1. ubuntu docker çš„ç›¸å…³é…ç½®æ–‡ä»¶

æ”»å‡»æœºï¼š
```conf
#
# This is a sample network config uncomment lines to configure the network
#


# Static config for eth0
auto eth0
iface eth0 inet static
	address 192.168.1.2
	netmask 255.255.255.0
	gateway 192.168.1.1
#	up echo nameserver 192.168.1.1 > /etc/resolv.conf

# DHCP config for eth0
# auto eth0
# iface eth0 inet dhcp
```

ç›®æ ‡æœºï¼š
```conf
#
# This is a sample network config uncomment lines to configure the network
#


# Static config for eth0
auto eth0
iface eth0 inet static
	address 192.168.1.64
	netmask 255.255.255.0
	gateway 192.168.1.1
#	up echo nameserver 192.168.0.1 > /etc/resolv.conf

# DHCP config for eth0
# auto eth0
# iface eth0 inet dhcp
```

#### 2. ä¸¤ä¸ªè·¯ç”±å™¨é…ç½®

> å‘½ä»¤éƒ½æ˜¯åœ¨å‘½ä»¤è¡Œç•Œé¢ç”¨çš„

1. 3640ï¼Œç”¨äºæ¨¡æ‹Ÿäº¤æ¢æœºï¼š

```bash
# è¿›å…¥ç‰¹æƒæ¨¡å¼
conf t
no ip routing
```

2. 7200ï¼Œç”¨æˆ·æ¨¡æ‹Ÿç½‘å…³ï¼š

```bash
# è¿›å…¥ç‰¹æƒæ¨¡å¼
conf t
# è¿›å…¥å¯¹åº”ç«¯å£ï¼Œè¿™ä¸ªæ˜¯ä½ è‡ªå·±è®¾ç½®çš„
int fa0/0
# è®¾ç½®å¯¹åº”çš„ ip å’Œæ©ç 
ip addr 192.168.1.1 255.255.255.0
```

3. ä¿å­˜é…ç½®ã€‚å¦‚æœä½ æ‹…å¿ƒè·¯ç”±å™¨è®¾å¤‡åœ¨å…³æœºä¹‹åé…ç½®ä¸¢å¤±ï¼Œé‚£ä¹ˆéœ€è¦å¦‚ä¸‹å‘½ä»¤å°†å…¶**æŒä¹…åŒ–ä¿å­˜**ï¼š

```bash
copy running-config start-config
# ä¸€å †ç¡®è®¤
write
```

#### 3. arpspoof çš„ä½¿ç”¨

æˆ‘åªä¼šè¿™ä¸€ä¸ªï¼Œå°±æ˜¯ç”¨æ¥å¯¹ç›®æ ‡æœºè¿›è¡Œ arp æ¬ºéª—æ”»å‡»çš„
```bash
arpspoof -i eth0 -t 192.168.1.64 192.168.1.1
```

#### 4. tmux çš„ä½¿ç”¨

> ä¸ºä»€ä¹ˆæˆ‘ä¸ç”¨ wireshark ï¼Ÿ  
> çœ‹å›¾ï¼Œæˆ‘æœ‰å•¥åŠæ³•ï¼Œæˆ‘è¦èƒ½ç”¨æˆ‘æ—©ç”¨äº†ğŸ˜­ğŸ˜­ğŸ˜­  
> ![wireshark æŠ¥é”™](./img/wiresharkErr.png)

1. ä½¿ç”¨ `tmux` å‘½ä»¤ç›´æ¥è¿›å…¥ tmux æ¨¡å¼ï¼›
2. `ctrl + b` + `%` æ°´å¹³åˆ†å±ï¼›`ctrl + b` + `"` å‚ç›´åˆ†å±
3. `ctrl + b` + `æ–¹å‘é”®` ï¼Œåˆ‡æ¢ç„¦ç‚¹çª—å£